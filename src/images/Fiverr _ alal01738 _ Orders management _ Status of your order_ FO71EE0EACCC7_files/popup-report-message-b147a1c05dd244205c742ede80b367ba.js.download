this.Fiverr=this.Fiverr||{},this.Fiverr.Templates=this.Fiverr.Templates||{},this.Fiverr.Templates["popups/popup-report-message"]=Handlebars.template({1:function(e,t,s,a){var n=this.lambda,r=this.escapeExpression;return'            <label class="fake-radio-green radio-text">\n                <input type="radio" name="reportReason" value='+r(n(null!=e?e.name:e,e))+' />\n                <span class="radio-img"></span>\n                '+r(n(null!=e?e.value:e,e))+"\n            </label>\n"},3:function(e,t,s,a){var n;return"                "+(null!=(n=(t.getI18nText||e&&e.getI18nText||t.helperMissing).call(e,"conversations._message.report_popup.step_3_alt",{name:"getI18nText",hash:{},data:a}))?n:"")+"\n"},5:function(e,t,s,a){var n;return"                "+(null!=(n=(t.getI18nText||e&&e.getI18nText||t.helperMissing).call(e,"conversations._message.report_popup.step_3",{name:"getI18nText",hash:{},data:a}))?n:"")+"\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,s,a){var n,r=t.helperMissing;return'<form class="popup-base popup-report-message js-popup-report-message step-1-active">\n\n    <header>\n        <a href="#!" class="btn-close js-btn-close">&times;</a>\n        <h2>'+(null!=(n=(t.getI18nText||e&&e.getI18nText||r).call(e,"conversations._message.report_popup.title.initial",{name:"getI18nText",hash:{},data:a}))?n:"")+'</h2>\n    </header>\n\n    <section class="popup-content step-1">\n        <h3>\n            '+(null!=(n=(t.getI18nText||e&&e.getI18nText||r).call(e,"conversations._message.report_popup.step_1.title",{name:"getI18nText",hash:{},data:a}))?n:"")+"\n            <small>"+(null!=(n=(t.getI18nText||e&&e.getI18nText||r).call(e,"conversations._message.report_popup.step_1.subtitle",{name:"getI18nText",hash:{},data:a}))?n:"")+"</small>\n        </h3>\n"+(null!=(n=t.each.call(e,null!=e?e.report_reasons:e,{name:"each",hash:{},fn:this.program(1,a,0),inverse:this.noop,data:a}))?n:"")+'        <div class="textarea-wrapper hidden">\n            <textarea name="otherText" rows="4" maxlength="100" placeholder="'+(null!=(n=(t.getI18nText||e&&e.getI18nText||r).call(e,"conversations._message.report_popup.step_1.reasons.other.placeholder",{name:"getI18nText",hash:{},data:a}))?n:"")+'"></textarea>\n            <span class="error-message">'+(null!=(n=(t.getI18nText||e&&e.getI18nText||r).call(e,"conversations._message.report_popup.step_1.reasons.other.error",{name:"getI18nText",hash:{},data:a}))?n:"")+'</span>\n        </div>\n    </section>\n\n    <section class="popup-content step-2">\n        <h3>'+(null!=(n=(t.getI18nText||e&&e.getI18nText||r).call(e,"conversations._message.report_popup.step_2.title",{name:"getI18nText",hash:{},data:a}))?n:"")+'</h3>\n        <label class="fake-check-black check-text disabled">\n            <input type="checkbox" name="review" checked="checked" disabled="disabled" />\n            <span class="chk-img"></span>\n            '+(null!=(n=(t.getI18nText||e&&e.getI18nText||r).call(e,"conversations._message.report_popup.step_2.review",{name:"getI18nText",hash:{},data:a}))?n:"")+'\n        </label>\n        <label class="fake-check-black check-text">\n            <input type="checkbox" name="block" />\n            <span class="chk-img"></span>\n            '+(null!=(n=(t.getI18nText||e&&e.getI18nText||r).call(e,"conversations._message.report_popup.step_2.block",{name:"getI18nText",hash:{},data:a}))?n:"")+'\n        </label>\n    </section>\n\n    <section class="popup-content step-3">\n        <p>\n'+(null!=(n=t["if"].call(e,null!=e?e.isOrderReport:e,{name:"if",hash:{},fn:this.program(3,a,0),inverse:this.program(5,a,0),data:a}))?n:"")+'        </p>\n    </section>\n\n    <section class="popup-content error-message">\n        <p>'+(null!=(n=(t.getI18nText||e&&e.getI18nText||r).call(e,"conversations._message.report_popup.error",{name:"getI18nText",hash:{},data:a}))?n:"")+'</p>\n    </section>\n\n    <footer>\n        <a href="#!" class="btn-standard js-btn-close">'+(null!=(n=(t.getI18nText||e&&e.getI18nText||r).call(e,"conversations._message.report_popup.cancel",{name:"getI18nText",hash:{},data:a}))?n:"")+'</a>\n        <a href="#!" class="btn-standard btn-green-grad btn-submit js-btn-submit disabled">'+(null!=(n=(t.getI18nText||e&&e.getI18nText||r).call(e,"conversations._message.report_popup.submit",{name:"getI18nText",hash:{},data:a}))?n:"")+"</a>\n    </footer>\n\n</form>\n"},useData:!0}),function(){"use strict";var e,t,s,a;a={models:{inOrderPage:"orders"===Fiverr.models.ps.main||"manage_orders"===Fiverr.models.ps.main,orderStatus:"",otherMinLength:2,steps:{reasons:1,actions:2,thankYou:3,error:4},defaultReasons:{report_reasons:[{name:"payment",value:$.t("conversations._message.report_popup.step_1.reasons.payment.text")},{name:"inappropriate",value:$.t("conversations._message.report_popup.step_1.reasons.inappropriate.text")},{name:"spam",value:$.t("conversations._message.report_popup.step_1.reasons.spam.text")},{name:"other",value:$.t("conversations._message.report_popup.step_1.reasons.other.text")}]}},selectors:{},init:function(){t.inOrderPage?e.getReasonsData():e.renderPopup()},getReasonsData:function(){t.orderStatus=e.formatOrderStatus(),$.getJSON("/reports/fetch_options?order_status="+t.orderStatus,function(t){t.isOrderReport=!0,e.renderPopup(t)})},renderPopup:function(s){Fiverr._getHbTemplate({tplType:"popups",tplName:"popup-report-message",tplData:s||t.defaultReasons,callback:e.bindReportBtn})},formatOrderStatus:function(){if("buyer"===$(".db-content-order-detail").data("user-type")){var e=$(".js-order-delivery").length>0?"post":"pre";return"buyer_"+e+"_delivery"}return"seller_reporting"},bindReportBtn:function(t){s.$popup=$(t),$("body").append(s.$popup),e.bindPopup(),$(".js-messages, .js-older-messages, .js-messages-flow").on("click",".js-btn-report",e.onBtnReportClicked)},onBtnReportClicked:function(t){t.preventDefault(),e.showPopup(),s.$reportedMessageBtn=$(this)},showPopup:function(){s.$popup.bPopup({closeClass:"js-btn-close",opacity:.6,follow:[!0,!0],onOpen:e.onPopupOpened,onClose:e.resetForm})},onPopupOpened:function(){Fiverr.models.ps.isMobileResponsive&&setTimeout(function(){$(document).trigger("resize")},500)},bindPopup:function(){s.$header=s.$popup.find("h2"),s.$footer=s.$popup.find("footer"),s.$btnSubmit=s.$footer.find(".js-btn-submit"),s.$textareaWrapper=s.$popup.find(".textarea-wrapper"),s.$textarea=s.$textareaWrapper.find("textarea"),s.$btnClose=s.$footer.find(".js-btn-close"),t.activeStep=t.steps.reasons,s.$btnSubmit.on("click",e.onBtnSubmitClicked),s.$popup.find(".step-1").on("change","input",e.onBtnReasonChanged),s.$textarea.on("input",e.onTextareaChanged)},onBtnSubmitClicked:function(a){if(a.preventDefault(),!s.$btnSubmit.hasClass("disabled")){if(!s.$textareaWrapper.hasClass("hidden")&&s.$textarea.val().length<t.otherMinLength)return void s.$textareaWrapper.addClass("has-error");var n=e.skipBlockStep()?t.steps.reasons:t.steps.actions;t.activeStep===n?e.sendForm():(e.moveToStep("step-"+(t.activeStep+1)+"-active"),t.activeStep++)}},onBtnReasonChanged:function(){s.$btnSubmit.removeClass("disabled"),"other"===$(this).val()?s.$textareaWrapper.removeClass("hidden"):s.$textareaWrapper.hasClass("hidden")||s.$textareaWrapper.addClass("hidden")},onTextareaChanged:function(){s.$textarea.val().length>=t.otherMinLength&&s.$textareaWrapper.removeClass("has-error")},sendForm:function(){t.blockConversation=s.$popup.find('input[name="block"]').get(0).checked;var a={message_id:s.$reportedMessageBtn.data("message-id"),sender_id:s.$reportedMessageBtn.data("sender-id"),recipient_id:s.$reportedMessageBtn.data("recipient-id"),report_data:{reasons:[{reason:s.$popup.find('input[name="reportReason"]:checked').val()}]},action:{block_conversation:t.blockConversation}};t.inOrderPage&&(a.order_id=Fiverr.models.ps.orderId),"other"===a.report_data.reasons[0].reason&&(a.report_data.reasons[0].text=s.$textarea.val()),s.$btnSubmit.addClass("in-progress"),$.ajax({type:"post",url:"/messages/"+a.message_id+"/report",dataType:"json",contentType:"application/json",data:JSON.stringify(a),success:e.onSuccess,error:e.onError})},skipBlockStep:function(){return t.inOrderPage||!document.viewData.blockable},onSuccess:function(){s.$btnClose.addClass("btn-green-grad").text($.t("conversations._message.report_popup.close")),s.$btnSubmit.removeClass("in-progress");var a=t.inOrderPage?"_alt":"";s.$header.text($.t("conversations._message.report_popup.title.success"+a));var n=e.skipBlockStep()?2:1;e.moveToStep("step-"+(t.activeStep+n)+"-active"),t.activeStep=t.steps.thankYou,s.$reportedMessageBtn.addClass("reported").text($.t("conversations._message.reported")),$(".js-btn-report:not(.reported)").addClass("hidden"),t.blockConversation&&($(".msg-form").addClass("hidden"),$(".conversation-blocked").removeClass("hidden-override"))},onError:function(){s.$btnClose.addClass("btn-green-grad").text($.t("conversations._message.report_popup.close")),s.$btnSubmit.removeClass("in-progress"),e.moveToStep("with-error")},resetForm:function(){s.$header.text($.t("conversations._message.report_popup.title.initial")),e.moveToStep("step-1-active"),t.activeStep=t.steps.reasons,s.$btnClose.removeClass("btn-green-grad").text($.t("conversations._message.report_popup.cancel")),s.$btnSubmit.addClass("disabled"),s.$popup.get(0).reset(),s.$popup.removeClass("with-error"),s.$textareaWrapper.removeClass("has-error").addClass("hidden")},moveToStep:function(e){s.$popup.removeClass("step-"+t.activeStep+"-active").addClass(e)}},e=a,s=e.selectors,t=e.models,a.init()}();