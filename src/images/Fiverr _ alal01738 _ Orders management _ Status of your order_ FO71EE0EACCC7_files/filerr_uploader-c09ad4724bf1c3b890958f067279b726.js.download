!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=38)}({13:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(e,n,a){r(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n));return i.type=a,i.status=e,i}return a(t,e),t}(Error);t["default"]=i,e.exports=t["default"]},16:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UploadErrorTypes={GET_POLICY:"GetPolicy",UPLOAD_FILE:"UploadFile",CREATE_PENDING_ATTACHMENT:"CreatePendingAttachment"}},17:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendGraph=void 0;var r=n(64);t.sendGraph=r.alias("_logEventToGraphite")},23:function(e,t,n){"use strict";function r(e){return new Promise(function(t){t(e.type)})}function o(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function a(e){return!e||e.split(".").length<2?"":e.split(".").pop()}Object.defineProperty(t,"__esModule",{value:!0}),t.getFileType=r,t.guid=o,t.extractFileExtension=a},24:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(e){function t(e,n,a,i){r(this,t);var u=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return u.info=n,u.type=a,u.policy=i,u}return a(t,e),i(t,null,[{key:"types",get:function(){return{FILE_TYPE_VIOLATION:"type",FILE_SIZE_VIOLATION:"size"}}}]),t}(Error);t["default"]=u,e.exports=t["default"]},25:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.gofor=void 0;var r=n(73),o=function(e){return e&&e.__esModule?e:{"default":e}}(r),a=function(){var e=(new o["default"]).interfaces.Headers,t=new e;t.append("X-Requested-With","XMLHttpRequest"),t.append("Content-Type","application/json; charset=utf-8"),t.append("Accept","application/json");try{t.append("X-CSRF-Token",document.AUTH_TOKEN)}catch(e){}return t},i=function(){return{credentials:"same-origin",headers:a()}},u=new o["default"](i).fetch;u.config=function(){return setTimeout(function(){throw new Error("Re configuration of Gofor is not allowed")})},t.gofor=u},32:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.PolicyValidationError=t.RemoteActionError=t.FilerrUploader=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(63),u=r(i),l=n(24),s=r(l),c=n(13),f=r(c),d=n(59),p=r(d),h=function(){function e(t){o(this,e),e.validateConstructor(t),this.objectName=t.objectName,this.attachmentName=t.attachmentName,this.getPolicyUrl=t.getPolicyUrl,this.createPendingAttachmentIdUrl=t.createPendingAttachmentIdUrl,this.shouldBeRenamed=t.shouldBeRenamed,this.policyHandler=new p["default"](this.getPolicyUrl,this.objectName,this.attachmentName)}return a(e,[{key:"upload",value:function(t){e.validateUpload(t);var n=t.file,r=t.onSuccess,o=t.onError,a=t.onProgress,i=t.retryAttempts,l=new u["default"](this.objectName,this.attachmentName,this.getPolicyUrl,this.createPendingAttachmentIdUrl,n,this.policyHandler,this.shouldBeRenamed);return l.upload(r,o,a,i),l}}],[{key:"validateConstructor",value:function(e){if(!e)throw new Error("Options weren't provided, expecting: objectName, attachmentName, getPolicyUrl, [createPendingAttachmentIdUrl]");var t=e.objectName,n=e.attachmentName,r=e.getPolicyUrl,o=e.createPendingAttachmentIdUrl,a="Some required fields were'nt provided: ";if(t||(a+=" objectName, "),n||(a+=" attachmentName, "),r||(a+=" getPolicyUrl, "),"Some required fields were'nt provided: "!==a)throw new Error(a.slice(0,a.length-2));if(a="should be of type: String","string"!=typeof t&&(a=" ,objectName "+a),"string"!=typeof n&&(a=" ,attachmentName "+a),"string"!=typeof r&&(a=" ,getPolicyUrl "+a),o&&"string"!=typeof o&&(a=" ,createPendingAttachmentIdUrl "+a),"should be of type: String"!==a)throw new TypeError(a.slice(2))}},{key:"validateUpload",value:function(e){var t=e.file,n=e.onSuccess,r=e.onError,o=e.onProgress,a=e.retryAttempts,i="Some required fields were'nt provided: ";if(t||(i+=" file, "),n||(i+=" onSuccess, "),"Some required fields were'nt provided: "!==i)throw new Error(i.slice(0,i.length-2));if(!(t instanceof File))throw new TypeError("file should be of type: File");if(i="should be of type: Function","function"!=typeof n&&(i=" ,onSuccess "+i),r&&"function"!=typeof r&&(i=" ,onError "+i),o&&"function"!=typeof o&&(i=" ,onProgress "+i),"should be of type: Function"!==i)throw new TypeError(i.slice(2));if(a&&!(a instanceof Number))throw new TypeError("retryAttempts should be of type: Number")}}]),e}();t.FilerrUploader=h,t.RemoteActionError=f["default"],t.PolicyValidationError=s["default"]},38:function(e,t,n){"use strict";!function(){window.filerr_uploader=n(32)}()},59:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(25),u=n(17),l=n(24),s=r(l),c=n(23),f=n(16),d=n(13),p=r(d),h=function(){function e(t,n,r){o(this,e),this.getPolicyUrl=t,this.objectName=n,this.attachmentName=r}return a(e,[{key:"validatePolicy",value:function(e){var t=this;return this.getPolicy().then(function(n){return t.appendFileType(n,e)}).then(function(n){var r=n.policyData,o=n.fileType;return t.fiverrPolicyValidation(r.policy.fiverr_policy,o,e),{policyData:r,fileType:o}})}},{key:"getPolicy",value:function(){var e=this,t=Date.now();return this.policyPromise||(this.policyPromise=i.gofor(this.getPolicyUrl,{method:"POST",body:JSON.stringify({object_name:this.objectName,attachment_name:this.attachmentName})}).then(function(n){if(!n.ok)throw new p["default"](n.status,n.statusText,f.UploadErrorTypes.GET_POLICY);return e.logPolicyFetchTime(t),n.json()})["catch"](function(e){throw new p["default"](e.code,e.message,f.UploadErrorTypes.GET_POLICY)})),this.policyPromise}},{key:"logPolicyFetchTime",value:function(e){u.sendGraph({label:this.objectName+".filerr."+this.attachmentName+".s3_policy",timing:Date.now()-e})}},{key:"appendFileType",value:function(e,t){return c.getFileType(t).then(function(t){return{policyData:e,fileType:t}})}},{key:"fiverrPolicyValidation",value:function(e,t,n){!function(){if(e.supported_file_types&&e.supported_file_types.length&&-1===e.supported_file_types.indexOf(t))throw new s["default"]("Unsupported file type: "+t,"supported types are: "+e.supported_file_types,s["default"].types.FILE_TYPE_VIOLATION,e);if(e.unsupported_file_types&&e.unsupported_file_types.length&&-1!==e.unsupported_file_types.indexOf(t))throw new s["default"]("Unsupported file type: "+t,"unsupported types are: "+e.unsupported_file_types,s["default"].types.FILE_TYPE_VIOLATION,e)}(),function(){if(e.max_file_size&&e.max_file_size<n.size)throw new s["default"]("Unsupported file size: "+n.size,"supported size is: "+e.max_file_size,s["default"].types.FILE_SIZE_VIOLATION,e)}()}}]),e}();t["default"]=h,e.exports=t["default"]},60:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(25),i=n(17),u=n(16),l=n(13),s=function(e){return e&&e.__esModule?e:{"default":e}}(l),c=function(){function e(t,n,o,a,i){r(this,e),this.objectName=t,this.attachmentName=n,this.createPendingAttachmentIdUrl=o,this.s3ParsedData=a,this.file=i}return o(e,[{key:"createPendingAttachment",value:function(){return a.gofor(this.createPendingAttachmentIdUrl,{method:"POST",body:JSON.stringify({file_path:this.s3ParsedData.key,bucket_name:this.s3ParsedData.bucketName,attachment_name:this.attachmentName,file_data:{file_path:this.s3ParsedData.key,bucket_name:this.s3ParsedData.bucketName,etag:this.s3ParsedData.etag,attachment_name:this.attachmentName,file_size:this.file.size,content_type:this.file.type}})})}},{key:"logCreatePendingAttachmentTime",value:function(e){i.sendGraph({label:this.objectName+".filerr."+this.attachmentName+".pending_attachment_creation",timing:Date.now()-e})}},{key:"handleCreatePendingAttachmentIdLogic",value:function(){var e=this;if(!this.createPendingAttachmentIdUrl)return this.s3ParsedData;var t=Date.now();return this.createPendingAttachment().then(function(n){if(!n.ok)throw new s["default"](n.status,n.statusText,u.UploadErrorTypes.CREATE_PENDING_ATTACHMENT);return e.logCreatePendingAttachmentTime(t),n.json()})["catch"](function(e){throw new s["default"](e.code,e.message,u.UploadErrorTypes.CREATE_PENDING_ATTACHMENT)}).then(function(t){return Object.assign(e.s3ParsedData,{pendingAttachmentData:t})})}}]),e}();t["default"]=c,e.exports=t["default"]},61:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(23),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}(a),u=/[&$+,/:;=?@<>[\]{}|\\^~%#]/g,l=function(){function e(t,n){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r(this,e),this.filename=t,this.key=n,this.shouldBeRenamed=o}return o(e,[{key:"generateGuidFilename",value:function(){return i.guid()+"."+i.extractFileExtension(this.filename)}},{key:"replaceInvalidCharacters",value:function(){return this.filename.replace(u,"_")}},{key:"handle",value:function(){var e=this.shouldBeRenamed?this.generateGuidFilename():this.replaceInvalidCharacters();return e!==this.filename?""+this.key.slice(0,this.key.lastIndexOf("/")+1)+e:this.key}}]),e}();t["default"]=l,e.exports=t["default"]},62:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(17),u=n(16),l=n(13),s=r(l),c=n(61),f=r(c),d=function(){function e(t,n,r,a,i,u,l,s){o(this,e),this.objectName=t,this.attachmentName=n,this.policyData=r,this.fileType=a,this.retryAttempts=i,this.file=u,this.onProgress=l,this.shouldRenamed=s}return a(e,[{key:"abort",value:function(){this.uploadXhrRequest&&this.uploadXhrRequest.abort()}},{key:"prepareDataForUpload",value:function(){var e=this.policyData.policy.s3_policy,t=this.fileType,n=Math.floor(26*Math.random())+Date.now(),r=e.guid+e.client_uniq_id_prefix+n,o=e.key.replace(e.guid,r),a=new FormData,i=new f["default"](this.file.name,o,this.shouldRenamed);return a.append("acl",e.acl),a.append("AWSAccessKeyId",e.AWSAccessKeyId),a.append("success_action_status",e.success_action_status),a.append("key",i.handle()),a.append("policy",e.policy),a.append("signature",e.signature),a.append("content-type",t),a.append("file",this.file),{formData:a,s3Policy:e}}},{key:"uploadToS3",value:function(e){var t=this;return new Promise(function(n,r){!function o(a){t.uploadXhrRequest=new XMLHttpRequest,t.uploadXhrRequest.upload.onprogress=function(e){var n=100*e.loaded/e.total;t.onProgress({progressEvent:e,percentage:n})},t.uploadXhrRequest.onload=function(){t.uploadXhrRequest.status>=200&&t.uploadXhrRequest.status<300?n(t.uploadXhrRequest.response):(a&&o(a-1),!a&&r(new s["default"](t.uploadXhrRequest.status,t.uploadXhrRequest.statusText,u.UploadErrorTypes.UPLOAD_FILE)))},t.uploadXhrRequest.onerror=function(){a&&o(a-1),!a&&r(new s["default"](t.uploadXhrRequest.status,t.uploadXhrRequest.statusText,u.UploadErrorTypes.UPLOAD_FILE))},t.uploadXhrRequest.open("POST",e.s3Policy.action_url),t.uploadXhrRequest.send(e.formData)}(t.retryAttempts)})}},{key:"logUploadTime",value:function(e){i.sendGraph({label:this.objectName+".filerr."+this.attachmentName+".s3_direct_upload",timing:Date.now()-e})}},{key:"parseS3UploadedData",value:function(e){var t=document.createRange().createContextualFragment(e);return{key:t.querySelector("Key").firstChild.nodeValue,bucketName:t.querySelector("Bucket").firstChild.nodeValue,etag:t.querySelector("Etag").firstChild.nodeValue.split('"').join("")}}},{key:"handleUploadLogic",value:function(){var e=this,t=this.prepareDataForUpload(),n=Date.now();return this.uploadToS3(t).then(function(t){return e.logUploadTime(n),e.parseS3UploadedData(t)})}}]),e}();t["default"]=d,e.exports=t["default"]},63:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(62),u=r(i),l=n(60),s=r(l),c=function(){function e(t,n,r,a,i,u,l){o(this,e),this.objectName=t,this.attachmentName=n,this.getPolicyUrl=r,this.createPendingAttachmentIdUrl=a,this.file=i,this.policyHandler=u,this.shouldBeRenamed=l,this.handleCreatePendingAttachmentIdLogic=this.handleCreatePendingAttachmentIdLogic.bind(this)}return a(e,[{key:"abort",value:function(){this.uploadHandler&&this.uploadHandler.abort()}},{key:"upload",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return{}},n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return{}},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5;this.handlePolicyLogic().then(function(e){var t=e.policyData,a=e.fileType;return n.handleUploadLogic(t,a,r,o)}).then(this.handleCreatePendingAttachmentIdLogic).then(e)["catch"](t)}},{key:"handlePolicyLogic",value:function(){return this.policyHandler.validatePolicy(this.file)}},{key:"handleUploadLogic",value:function(e,t,n,r){return this.uploadHandler=new u["default"](this.objectName,this.attachmentName,e,t,r,this.file,n,this.shouldBeRenamed),this.uploadHandler.handleUploadLogic()}},{key:"handleCreatePendingAttachmentIdLogic",value:function(e){return new s["default"](this.objectName,this.attachmentName,this.createPendingAttachmentIdUrl,e,this.file).handleCreatePendingAttachmentIdLogic()}}]),e}();t["default"]=c,e.exports=t["default"]},64:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(e){return"object"===("undefined"==typeof Fiverr?"undefined":r(Fiverr))&&"function"==typeof Fiverr[e]||void 0};t.alias=function(e){return function(){var t;return o(e)&&(t=Fiverr)[e].apply(t,arguments)}}},73:function(e,t){e.exports=Gofor}});