!function(e){var t={init:function(i){return this.each(function(){var n=e(this);n.data("uploadifive",{inputs:{},inputCount:0,fileID:0,queue:{count:0,selected:0,replaced:0,errors:0,queued:0,cancelled:0},uploads:{current:0,attempts:0,successful:0,errors:0,count:0}});var r=n.data("uploadifive"),a=r.settings=e.extend({auto:!0,buttonClass:!1,buttonText:"Select Files",checkScript:!1,dnd:!0,dropTarget:!1,fileObjName:"Filedata",fileSizeLimit:0,fileType:!1,minImgDimensions:!1,formData:{},height:30,itemTemplate:!1,method:"post",multi:!0,overrideEvents:[],queueID:!1,queueSizeLimit:0,removeCompleted:!1,simUploadLimit:0,truncateLength:0,uploadLimit:0,totalUploadLimit:0,uploadScript:"uploadifive.php",width:100},i);if(isNaN(a.fileSizeLimit)){var l=1.024*parseInt(a.fileSizeLimit);a.fileSizeLimit.indexOf("KB")>-1?a.fileSizeLimit=1e3*l:a.fileSizeLimit.indexOf("MB")>-1?a.fileSizeLimit=1e6*l:a.fileSizeLimit.indexOf("GB")>-1&&(a.fileSizeLimit=1e9*l)}else a.fileSizeLimit=1024*a.fileSizeLimit;i.attachmentName&&(window.filerrAttachments?(n.filerrAttachments=new window.filerrAttachments(i.attachmentName),a.isFilerrOnly=n.filerrAttachments.isFilerrOnly()):fLoader({immediate:!0,load:["//assetsv2.fiverrcdn.com/assets/modules/filerr_uploader-c09ad4724bf1c3b890958f067279b726.js","//assetsv2.fiverrcdn.com/assets/filerr-attachments-ad61ebe4436981baf4202c6c744c65f4.js"],complete:function(){n.filerrAttachments=new window.filerrAttachments(i.attachmentName),a.isFilerrOnly=n.filerrAttachments.isFilerrOnly()}})),r.inputTemplate=e('<input type="file" class="uploadifive-input">').css({"font-size":a.height+"px",opacity:0,position:"absolute",right:"-3px",top:"-3px","z-index":999}),r.createInput=function(){var i=r.inputTemplate.clone(),l=i.name="input"+r.inputCount++;if(i.attr("multiple",!!a.multi),a.fileType){var o=e.isArray(a.fileType)?a.fileType.join(", "):a.fileType;i.attr("accept",o)}i.bind("change",function(){r.queue.selected=0,r.queue.replaced=0,r.queue.errors=0,r.queue.queued=0;var i=this.files.length;if(r.queue.selected=i,"function"==typeof a.onSelect&&a.onSelect.call(n,r.queue),r.queue.count+i>a.queueSizeLimit&&0!==a.queueSizeLimit)return e.inArray("onError",a.overrideEvents)<0&&alert("The maximum number of queue items has been reached ("+a.queueSizeLimit+").  Please select fewer files."),"function"==typeof a.onError&&a.onError.call(n,"QUEUE_LIMIT_EXCEEDED"),!1;for(var o=0;i>o;o++)file=this.files[o],r.addQueueItem(file);r.inputs[l]=this,r.createInput(),a.auto&&t.upload.call(n)}),r.currentInput&&(a.removeCompleted?r.currentInput.remove():r.currentInput.hide()),r.button.append(i),r.currentInput=i},r.destroyInput=function(t){e(r.inputs[t]).remove(),delete r.inputs[t],r.inputCount--},r.drop=function(i){r.queue.selected=0,r.queue.replaced=0,r.queue.errors=0,r.queue.queued=0;var l=i.dataTransfer,o=l.name="input"+r.inputCount++,u=l.files.length;if(r.queue.selected=u,r.queue.count+u>a.queueSizeLimit&&0!==a.queueSizeLimit)e.inArray("onError",a.overrideEvents)<0&&alert("The maximum number of queue items has been reached ("+a.queueSizeLimit+").  Please select fewer files."),"function"==typeof a.onError&&a.onError.call(n,"QUEUE_LIMIT_EXCEEDED");else{for(var s=0;u>s;s++)file=l.files[s],r.addQueueItem(file);r.inputs[o]=l}a.auto&&t.upload.call(n),"function"==typeof a.onDrop&&a.onDrop.call(n,l.files,l.files.length),i.preventDefault(),i.stopPropagation()},r.fileExistsInQueue=function(e){for(var t in r.inputs){input=r.inputs[t],limit=input.files.length;for(var i=0;i<limit;i++)if(existingFile=input.files[i],existingFile.name==e.name&&!existingFile.complete)return!0}return!1},r.removeExistingFile=function(e){for(var i in r.inputs){input=r.inputs[i],limit=input.files.length;for(var a=0;a<limit;a++)existingFile=input.files[a],existingFile.name!=e.name||existingFile.complete||(r.queue.replaced++,t.cancel.call(n,existingFile,!0,!1))}},0==a.itemTemplate?r.queueItem=e('<div class="uploadifive-queue-item">                        <a class="close" href="#">X</a>                        <div><span class="filename"></span><span class="filesize"></span><span class="fileinfo"></span></div>                        <div class="progress">                            <div class="progress-bar"></div>                        </div>                    </div>'):r.queueItem=e(a.itemTemplate);var o=function(e){for(var t=["bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],i=0,n=parseInt(e,10)||0;n>=1024&&++i;)n/=1024;var r=t[i];return r?n.toFixed(2)+r:"Undefined"};if(r.addQueueItem=function(i){if(e.inArray("onAddQueueItem",a.overrideEvents)<0){r.removeExistingFile(i),i.queueItem=r.queueItem.clone(),i.queueItem.attr("id","upload-file-"+r.fileID++),i.fileId=r.fileID.toString(),i.queueItem.find(".close").bind("click",function(){return t.cancel.call(n,i),!1});var l=o(i.size),u=i.name;if(u.length>a.truncateLength&&0!=a.truncateLength){var s=u.match(/([a-zA-Z\d]+)$/)[0];u=u.substring(0,a.truncateLength)+"..."+s}i.queueItem.find(".filename").html(u),i.queueItem.find(".filesize").html(l),i.queueItem.data("file",i),r.queueEl.append(i.queueItem)}if("function"==typeof a.onAddQueueItem&&a.onAddQueueItem.call(n,i),a.fileType)if(e.isArray(a.fileType)){for(var d=!1,p=0;p<a.fileType.length;p++)i.type.indexOf(a.fileType[p])>-1&&(d=!0);d||r.error("FORBIDDEN_FILE_TYPE",i)}else i.type.indexOf(a.fileType)<0&&r.error("FORBIDDEN_FILE_TYPE",i);if(i.size>a.fileSizeLimit&&0!=a.fileSizeLimit&&r.error("FILE_SIZE_LIMIT_EXCEEDED",i),a.minImgDimensions){var f=new FileReader,c=a.minImgDimensions.split("*");f.readAsDataURL(i),f.onloadend=function(){var e=new Image;e.onload=function(){(this.width<c[0]||this.height<c[1])&&r.error("FILE_IMG_DIMENSIONS",i)},e.src=this.result}}/[<>"'\/\{\}]/.test(i.name)?r.error("INVALID_FILE_NAME",i):(r.queue.queued++,r.queue.count++)},r.removeQueueItem=function(t,i,a){n.filerrAttachments&&n.filerrAttachments.removePendingAttachmentId(t.fileId),a||(a=0);var l=i?0:500;t.queueItem&&(t.queueItem.find(".progress-bar").width(0),t.queueItem.delay(a).fadeOut(l,function(){e(this).remove()}),delete t.queueItem,r.queue.queued--,r.queue.count--)},r.filesToUpload=function(){var e=0;for(var t in r.inputs){input=r.inputs[t],limit=input.files.length;for(var i=0;i<limit;i++)file=input.files[i],file.skip||file.complete||e++}return e},r.checkExists=function(i){if(e.inArray("onCheck",a.overrideEvents)<0){e.ajaxSetup({async:!1});var r=e.extend(a.formData,{filename:i.name});if(e.post(a.checkScript,r,function(e){i.exists=parseInt(e)}),i.exists&&!confirm("A file named "+i.name+" already exists in the upload folder.\nWould you like to replace it?"))return t.cancel.call(n,i),!0}return"function"==typeof a.onCheck&&a.onCheck.call(n,i,i.exists),!1},r.uploadFile=function(e,t){if(!e.skip&&!e.complete&&!e.uploading){var i=a.attachmentName||a.flowType;if(e.uploading=!0,r.uploads.current++,r.uploads.attempted++,i&&(Fiverr._logEventToGraphite({label:"order_flow."+i+".file_size",value:e.size,percentage:100}),a.isFilerrOnly||Fiverr._logEventToGraphite({label:"order_flow."+i+".upload_methods.v2_only",value:1,percentage:100})),n.filerrAttachments)try{var l=function(i){if(i.pendingAttachmentData&&i.pendingAttachmentData.attachment_id){var l=i.pendingAttachmentData.attachment_id;n.filerrAttachments.addPendingAttachmentId(l),a.isFilerrOnly?r.uploadComplete(i,e,t):n.filerrAttachments.updateAttachmentsMap(e.fileId,{newAttachmentId:l})}},o=a.isFilerrOnly?function(t){t&&t.progressEvent.lengthComputable&&r.progress(t.progressEvent,e)}:function(){},u=function(e){Fiverr._logErrorToServer("jquery.uploadifive.js","filerr uploadError",e),Fiverr._logEventToGraphite({label:"order_flow."+a.attachmentName+".filerr.errors",value:1,percentage:100})};n.filerrUploader||(n.filerrUploader=new filerr_uploader.FilerrUploader(n.filerrAttachments.getFilerrConfig())),Fiverr._logEventToGraphite({label:"order_flow."+a.attachmentName+".upload_methods.filerr_only",value:1,percentage:100}),n.filerrAttachments.updateAttachmentsMap(e.fileId,{uploaderManager:n.filerrUploader.upload({file:e,onSuccess:l,onError:u,onProgress:o})})}catch(s){Fiverr._logErrorToServer("jquery.uploadifive.js","filerr uploadError",s)}return}},r.progress=function(t,i){if(e.inArray("onProgress",a.overrideEvents)<0){if(t.lengthComputable)var r=Math.round(t.loaded/t.total*100);i.queueItem.find(".fileinfo").html(r+"%"),i.queueItem.find(".progress-bar").css("width",r+"%")}"function"==typeof a.onProgress&&a.onProgress.call(n,i,t)},r.error=function(i,l,o){if(e.inArray("onError",a.overrideEvents)<0){switch(i){case"404_FILE_NOT_FOUND":errorMsg="404 Error";break;case"403_FORBIDDEN":errorMsg="403 Forbidden";break;case"FORBIDDEN_FILE_TYPE":errorMsg="Forbidden File Type";break;case"FILE_SIZE_LIMIT_EXCEEDED":errorMsg="File Too Large";break;case"FILE_IMG_DIMENSIONS":errorMsg="Minimum Image Dimensions Are Not Met";break;case"INVALID_FILE_NAME":errorMsg="Invalid file name";break;case"SESSION_EXPIRED":errorMsg="Session expired";break;default:errorMsg="Unknown Error"}l.queueItem.addClass("error").find(".fileinfo").html(errorMsg),l.queueItem.find(".progress").remove()}"function"==typeof a.onError&&a.onError.call(n,i,l),l.skip=!0,"404_FILE_NOT_FOUND"==i?r.uploads.errors++:r.queue.errors++,o&&t.upload.call(n,null,!0)},r.uploadComplete=function(i,l,o){if(e.inArray("onUploadComplete",a.overrideEvents)<0&&(l.queueItem.find(".progress-bar").css("width","100%"),l.queueItem.find(".fileinfo").html(" - "+e.t("general.completed")),l.queueItem.find(".progress").slideUp(250),l.queueItem.addClass("complete")),"function"==typeof a.onUploadComplete){!l.xhr&&a.isFilerrOnly&&(l.id=i.pendingAttachmentData.attachment_id,l.fileId=l.id,l.xhr={responseText:JSON.stringify({id:i.pendingAttachmentData.attachment_id,attachment_id:i.pendingAttachmentData.attachment_id,size:i.pendingAttachmentData.file_size,download_url:i.pendingAttachmentData.download_url,type:i.pendingAttachmentData.preview_type,created_at:i.pendingAttachmentData.created_at,preview_url:i.pendingAttachmentData.preview_urls.small,url:i.pendingAttachmentData.preview_urls.small})});var u="<"==l.xhr.responseText[0]?l.xhr.responseXML:l.xhr.responseText;if(n.filerrAttachments&&!a.isFilerrOnly){var s={id:l.fileId};_.isObject(u)||(s=e.parseJSON(u)),n.filerrAttachments.updateAttachmentsMap(l.fileId,{oldAttachmentId:s.id})}a.onUploadComplete.call(n,l,u)}a.removeCompleted&&setTimeout(function(){t.cancel.call(n,l)},3e3),l.complete=!0,r.uploads.successful++,r.uploads.count++,r.uploads.current--,delete l.xhr,o&&t.upload.call(n,null,!0)},r.queueComplete=function(){"function"==typeof a.onQueueComplete&&a.onQueueComplete.call(n,r.uploads)},!(window.File&&window.FileList&&window.Blob&&(window.FileReader||window.FormData)))return"function"==typeof a.onFallback&&a.onFallback.call(n),!1;if(a.id="uploadifive-"+n.attr("id"),r.button=e('<div id="'+a.id+'" class="uploadifive-button">'+a.buttonText+"</div>"),a.buttonClass&&r.button.addClass(a.buttonClass),r.button.css({height:a.height,"line-height":a.height+"px",overflow:"hidden",position:"relative","text-align":"center",width:a.width}),n.before(r.button).appendTo(r.button).hide(),r.createInput.call(n),a.queueID?r.queueEl=e("#"+a.queueID):a.createQueueEl?(a.queueID=a.id+"-queue",r.queueEl=e('<div id="'+a.queueID+'" class="uploadifyQueue js-uploadifyQueue" />'),r.button.after(r.queueEl)):(a.queueID=(a.id+"-queue").replace("uploadifive-",""),r.queueEl=e("#"+a.queueID)),a.dnd){var u=a.dropTarget?e(a.dropTarget):r.queueEl.get(0);u.addEventListener("dragleave",function(e){e.preventDefault(),e.stopPropagation()},!1),u.addEventListener("dragenter",function(e){e.preventDefault(),e.stopPropagation()},!1),u.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation()},!1),u.addEventListener("drop",r.drop,!1)}XMLHttpRequest.prototype.sendAsBinary||(XMLHttpRequest.prototype.sendAsBinary=function(e){function t(e){return 255&e.charCodeAt(0)}var i=Array.prototype.map.call(e,t),n=new Uint8Array(i);this.send(n.buffer)}),"function"==typeof a.onInit&&a.onInit.call(n)})},debug:function(){return this.each(function(){console.log(e(this).data("uploadifive"))})},clearQueue:function(){this.each(function(){var t=e(this),i=t.data("uploadifive"),n=i.settings;"function"==typeof n.onClearQueue&&n.onClearQueue.call(t,e("#"+i.settings.queueID))})},clearQueueAndCancel:function(){this.each(function(){var n=e(this),r=n.data("uploadifive"),a=r.settings;for(var l in r.inputs)for(input=r.inputs[l],limit=input.files.length,i=0;i<limit;i++)file=input.files[i],t.cancel.call(n,file);"function"==typeof a.onClearQueue&&a.onClearQueue.call(n,e("#"+r.settings.queueID))})},cancel:function(i,n,r){var a=this.filerrAttachments&&this.filerrAttachments.getUploaderManager(i.fileId);r=null==typeof r||"undefined"==typeof r||r?!0:!1,this.each(function(){var l=e(this),o=l.data("uploadifive"),u=o.settings;"string"==typeof i&&(isNaN(i)||(fileID="uploadifive-"+e(this).attr("id")+"-file-"+i),i=e("#"+fileID).data("file")),i.skip=!0,o.filesCancelled++,i.uploading&&(o.uploads.current--,o.queue.queued--,i.uploading=!1,i.xhr.abort(),a&&a.abort(),delete i.xhr,t.upload.call(l)),e.inArray("onCancel",u.overrideEvents)<0&&o.removeQueueItem(i,n,2e3),"function"==typeof u.onCancel&&r&&u.onCancel.call(l,i,o.fileID)})},upload:function(t,i){this.each(function(){var n=e(this),r=n.data("uploadifive");if(r){var a=r.settings;if(t)r.uploadFile.call(n,t);else if(r.uploads.count+r.uploads.current<a.uploadLimit||0==a.uploadLimit){if(!i){r.uploads.attempted=0,r.uploads.successsful=0,r.uploads.errors=0;var l=r.filesToUpload();"function"==typeof a.onUpload&&a.onUpload.call(n,l)}e("#"+a.queueID).find(".uploadifive-queue-item").not(".error, .complete").each(function(){return _file=e(this).data("file"),r.uploads.current>=a.simUploadLimit&&0!==a.simUploadLimit||r.uploads.current>=a.uploadLimit&&0!==a.uploadLimit||r.uploads.count>=a.uploadLimit&&0!==a.uploadLimit?!1:void(a.checkScript?(_file.checking=!0,skipFile=r.checkExists(_file),_file.checking=!1,skipFile||r.uploadFile(_file,!0)):r.uploadFile(_file,!0))}),0==e("#"+a.queueID).find(".uploadifive-queue-item").not(".error, .complete").size()&&r.queueComplete()}else 0==r.uploads.current&&(e.inArray("onError",a.overrideEvents)<0&&r.filesToUpload()>0&&0!=a.uploadLimit&&alert("The maximum upload limit has been reached."),"function"==typeof a.onError&&a.onError.call(n,"UPLOAD_LIMIT_EXCEEDED",r.filesToUpload()))}})},destroy:function(){this.each(function(){var i=e(this),n=i.data("uploadifive"),r=n.settings;t.clearQueue.call(i),r.queueID||e("#"+r.queueID).remove(),i.siblings("input").remove(),i.show().insertBefore(n.button),n.button.remove(),"function"==typeof r.onDestroy&&r.onDestroy.call(i)})},getSettings:function(){var t=e(this),i=t.data("uploadifive"),n=i.settings;return n},updateSetting:function(t,i){var n=e(this),r=n.data("uploadifive"),a=r.settings;a[t]=i}};e.fn.uploadifive=function(i){return t[i]?t[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?void e.error("The method "+i+" does not exist in $.uploadifive"):t.init.apply(this,arguments)}}(jQuery);